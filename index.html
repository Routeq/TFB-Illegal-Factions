<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Illegal Faction - Weapons & Narcotics</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-black: #0a0a0a;
      --secondary-black: #1a1a1a;
      --primary-red: #ff0000;
      --dark-red: #8b0000;
      --text-white: #ffffff;
      --text-gray: #666666;
      --text-light-gray: #999999;
      --border-red: rgba(255, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      font-family: 'Rajdhani', sans-serif;
      background: var(--primary-black);
      color: var(--text-white);
      -webkit-font-smoothing: antialiased;
    }

    body {
      padding: 20px;
    }

    .wrapper {
      max-width: 1600px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border-red);
    }

    .header-left {
      flex: 1;
    }

    .logo-title {
      font-size: 42px;
      font-weight: 900;
      color: var(--primary-red);
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .logo-subtitle {
      font-size: 14px;
      color: var(--text-light-gray);
      font-weight: 400;
      letter-spacing: 2px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
      justify-content: flex-end;
    }

    .music-toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid var(--border-red);
      border-radius: 8px;
      color: var(--text-light-gray);
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .music-toggle:hover {
      border-color: var(--primary-red);
      color: var(--primary-red);
    }

    .user-profile {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid var(--border-red);
      border-radius: 8px;
      color: var(--text-light-gray);
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .user-profile:hover {
      border-color: var(--primary-red);
      color: var(--primary-red);
    }

    .logo-image {
      width: 100px;
      height: 100px;
      border: 3px solid var(--primary-red);
      border-radius: 12px;
      object-fit: contain;
      padding: 5px;
      background: rgba(0, 0, 0, 0.8);
      transition: all 0.3s ease;
    }

    .logo-image:hover {
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
      transform: scale(1.05);
    }

    /* Main Navigation Tabs */
    .main-nav {
      display: flex;
      gap: 30px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border-red);
      padding-bottom: 0;
      flex-wrap: wrap;
    }

    .main-tab {
      padding: 12px 0;
      color: var(--text-light-gray);
      border: none;
      background: none;
      cursor: pointer;
      font-weight: 700;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .main-tab:hover {
      color: var(--primary-red);
    }

    .main-tab.active {
      color: var(--primary-red);
      border-bottom: 2px solid var(--primary-red);
    }

    /* Subtabs */
    .subtabs {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .subtab {
      padding: 8px 16px;
      background: rgba(255, 0, 0, 0.15);
      border: 1px solid var(--border-red);
      color: var(--text-light-gray);
      border-radius: 6px;
      font-weight: 700;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .subtab:hover {
      background: rgba(255, 0, 0, 0.25);
      color: var(--primary-red);
      border-color: var(--primary-red);
    }

    .subtab.active {
      background: var(--primary-red);
      border-color: var(--primary-red);
      color: var(--primary-black);
    }

    /* Content Area */
    .content-area {
      background: transparent;
      min-height: 500px;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Section Title */
    .section-title {
      font-size: 28px;
      font-weight: 900;
      color: var(--primary-red);
      margin-bottom: 25px;
      text-transform: uppercase;
      letter-spacing: 2px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .section-title i {
      font-size: 32px;
    }

    /* Controls */
    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      align-items: center;
      flex-wrap: wrap;
    }

    .filter-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .filter-group label {
      color: var(--text-light-gray);
      font-weight: 700;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    select {
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid var(--border-red);
      color: var(--text-white);
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    select:hover {
      border-color: var(--primary-red);
    }

    select option {
      background: var(--secondary-black);
      color: var(--text-white);
    }

    /* Buttons */
    .btn {
      padding: 10px 20px;
      border: 1px solid var(--border-red);
      background: rgba(0, 0, 0, 0.6);
      border-radius: 6px;
      color: var(--text-light-gray);
      font-weight: 700;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn:hover {
      background: rgba(255, 0, 0, 0.1);
      border-color: var(--primary-red);
      color: var(--primary-red);
    }

    .btn-drop {
      background: linear-gradient(135deg, var(--primary-red), rgba(255, 0, 0, 0.7));
      border-color: var(--primary-red);
      color: var(--text-white);
      padding: 12px 24px;
      font-size: 13px;
      font-weight: 900;
    }

    .btn-drop:hover {
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
    }

    /* Grid */
    .items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .item-card {
      background: linear-gradient(135deg, rgba(20, 20, 20, 0.8), rgba(30, 30, 30, 0.8));
      border: 1px solid var(--border-red);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .item-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at center, var(--primary-red), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: -1;
    }

    .item-card:hover {
      border-color: var(--primary-red);
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(255, 0, 0, 0.3), inset 0 0 20px rgba(255, 0, 0, 0.05);
    }

    .item-card:hover::before {
      opacity: 0.1;
    }

    .item-image {
      width: 120px;
      height: 120px;
      object-fit: contain;
      margin: 0 auto 12px;
      filter: drop-shadow(0 2px 8px rgba(255, 0, 0, 0.3));
      transition: filter 0.3s ease;
    }

    .item-card:hover .item-image {
      filter: drop-shadow(0 4px 15px rgba(255, 0, 0, 0.6));
    }

    .item-name {
      font-weight: 900;
      font-size: 12px;
      color: var(--text-white);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      line-height: 1.3;
    }

    .item-rarity {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .rarity-common {
      background: rgba(100, 80, 60, 0.6);
      color: #d4a574;
      border: 1px solid #8b7355;
    }

    .rarity-uncommon {
      background: rgba(0, 100, 0, 0.6);
      color: #90ee90;
      border: 1px solid #4caf50;
    }

    .rarity-rare {
      background: rgba(0, 50, 150, 0.6);
      color: #64b5f6;
      border: 1px solid #2196f3;
    }

    .rarity-epic {
      background: rgba(100, 0, 150, 0.6);
      color: #ce93d8;
      border: 1px solid #9c27b0;
    }

    .rarity-legendary {
      background: rgba(255, 100, 0, 0.6);
      color: #ffb74d;
      border: 1px solid #ff9800;
    }

    /* Spin Wheel */
    .spin-section {
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(50, 10, 10, 0.5), rgba(20, 20, 20, 0.5));
      border: 1px solid var(--border-red);
      border-radius: 10px;
    }

    .spin-title {
      color: var(--primary-red);
      font-size: 16px;
      font-weight: 900;
      margin-bottom: 15px;
      text-transform: uppercase;
    }

    .spin-strip {
      display: flex;
      gap: 10px;
      overflow: hidden;
      width: 100%;
      height: 120px;
      padding: 8px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid var(--border-red);
      border-radius: 8px;
      position: relative;
      margin-bottom: 15px;
    }

    .spin-item {
      min-width: 120px;
      height: 100px;
      border-radius: 8px;
      overflow: hidden;
      background: rgba(20, 20, 20, 0.9);
      border: 1px solid rgba(255, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 6px;
      flex-shrink: 0;
    }

    .spin-item img {
      max-width: 100%;
      max-height: 50px;
      object-fit: contain;
      margin-bottom: 4px;
    }

    .spin-item-name {
      font-size: 10px;
      font-weight: 700;
      text-align: center;
      color: var(--text-white);
    }

    .spin-indicator {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 4px;
      height: 100px;
      background: linear-gradient(180deg, var(--primary-red), rgba(255, 0, 0, 0.5));
      border-radius: 2px;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.8);
      pointer-events: none;
      z-index: 10;
    }

    .landed-display {
      padding: 15px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid var(--border-red);
      border-radius: 8px;
      text-align: center;
      display: none;
      gap: 12px;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
    }

    .landed-display.active {
      display: flex;
    }

    .landed-image {
      max-width: 80px;
      max-height: 60px;
      object-fit: contain;
    }

    .landed-info {
      text-align: left;
    }

    .landed-label {
      font-weight: 900;
      color: var(--primary-red);
      margin-bottom: 4px;
      font-size: 12px;
    }

    .landed-name {
      font-weight: 900;
      font-size: 14px;
      color: var(--text-white);
    }

    .landed-rarity {
      font-weight: 700;
      font-size: 11px;
      margin-top: 2px;
    }

    .spin-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn-spin {
      padding: 12px 30px;
      background: linear-gradient(135deg, var(--primary-red), rgba(255, 0, 0, 0.7));
      color: var(--text-white);
      border: 1px solid var(--primary-red);
      border-radius: 8px;
      font-weight: 900;
      font-size: 12px;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s ease;
      box-shadow: 0 0 15px rgba(255, 0, 0, 0.4);
    }

    .btn-spin:hover:not(:disabled) {
      box-shadow: 0 0 25px rgba(255, 0, 0, 0.8);
      transform: translateY(-2px);
    }

    .btn-spin:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(135deg, rgba(20, 20, 20, 0.95), rgba(30, 20, 20, 0.95));
      border: 2px solid var(--primary-red);
      border-radius: 12px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(255, 0, 0, 0.5), inset 0 0 30px rgba(255, 0, 0, 0.1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-red);
    }

    .modal-title {
      font-size: 20px;
      font-weight: 900;
      color: var(--primary-red);
      text-transform: uppercase;
    }

    .close-btn {
      background: none;
      border: none;
      color: var(--primary-red);
      font-size: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .close-btn:hover {
      transform: rotate(90deg);
    }

    /* Victory Modal */
    .victory-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.98);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .victory-modal.active {
      display: flex;
    }

    .victory-card {
      background: linear-gradient(135deg, rgba(30, 10, 10, 0.95), rgba(10, 10, 30, 0.95));
      border: 3px solid var(--primary-red);
      border-radius: 15px;
      padding: 35px;
      max-width: 700px;
      width: 90%;
      text-align: center;
      box-shadow: 0 0 60px rgba(255, 0, 0, 0.7), inset 0 0 40px rgba(255, 0, 0, 0.1);
    }

    .victory-header {
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--primary-red);
    }

    .victory-title {
      font-size: 36px;
      font-weight: 900;
      color: var(--primary-red);
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 8px;
    }

    .victory-count {
      font-size: 14px;
      color: var(--text-light-gray);
      font-weight: 700;
    }

    .victory-items {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 12px;
      margin-bottom: 25px;
    }

    .victory-item {
      padding: 12px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid var(--border-red);
      border-radius: 8px;
      animation: victoryPop 0.4s ease-out backwards;
    }

    @keyframes victoryPop {
      from {
        opacity: 0;
        transform: scale(0.3);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .victory-item img {
      max-width: 70px;
      max-height: 70px;
      object-fit: contain;
      margin: 0 auto 8px;
      display: block;
    }

    .victory-item-name {
      font-weight: 700;
      font-size: 11px;
      color: var(--text-white);
      margin-bottom: 6px;
      text-transform: uppercase;
    }

    .victory-item-rarity {
      display: inline-block;
      padding: 3px 6px;
      border-radius: 3px;
      font-size: 9px;
      font-weight: 700;
    }

    /* Text Content */
    .content-text {
      color: var(--text-light-gray);
      line-height: 1.7;
      font-size: 14px;
      margin-bottom: 15px;
    }

    .content-text strong {
      color: var(--primary-red);
    }

    .section-subtitle {
      font-size: 16px;
      font-weight: 800;
      color: var(--primary-red);
      margin-top: 25px;
      margin-bottom: 12px;
      text-transform: uppercase;
    }

    ul, ol {
      margin-left: 20px;
      color: var(--text-light-gray);
    }

    li {
      margin-bottom: 8px;
      line-height: 1.6;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 15px;
      }

      .header-right {
        width: 100%;
        justify-content: flex-start;
      }

      .logo-title {
        font-size: 28px;
      }

      .logo-image {
        width: 80px;
        height: 80px;
      }

      .items-grid {
        grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
        gap: 12px;
      }

      .main-nav {
        gap: 15px;
      }

      .section-title {
        font-size: 20px;
      }

      .modal-content, .victory-card {
        padding: 20px;
      }
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <!-- Header -->
    <div class="header">
      <div class="header-left">
        <h1 class="logo-title">Illegal Faction</h1>
        <div class="logo-subtitle">United Weapons & Narcotics Network</div>
      </div>
      <div class="header-right">
        <div class="music-toggle" onclick="toggleMusic()">
          <i class="fas fa-volume-high"></i> <span id="musicLabel">MUSIC: OFF</span>
        </div>
        <div class="user-profile">
          <i class="fas fa-user-circle"></i> <span>user</span>
        </div>
        <img src="TFB.png" alt="Faction Logo" class="logo-image" onerror="this.style.display='none'">
      </div>
    </div>

    <!-- Main Navigation -->
    <div class="main-nav" id="mainNav"></div>

    <!-- Subtabs -->
    <div class="subtabs" id="subtabs"></div>

    <!-- Content Area -->
    <div class="content-area">
      <div id="content"></div>
    </div>
  </div>

  <!-- Item Modal -->
  <div id="itemModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="modalTitle">Item Details</h2>
        <button class="close-btn" onclick="closeModal()">Ã—</button>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- Victory Modal -->
  <div id="victoryModal" class="victory-modal">
    <div class="victory-card">
      <div class="victory-header">
        <div class="victory-title">ðŸŽ‰ YOU GOT!</div>
        <div class="victory-count" id="victoryCount">Items</div>
      </div>
      <div class="victory-items" id="victoryItems"></div>
      <button class="btn-spin" onclick="closeVictory()">COLLECT</button>
    </div>
  </div>

  <script>
    // Weapon Data with Stats
    const WEAPONS = {
      testDrops: [
        { name: 'Beretta', rarity: 'common', category: 'Pistols', img: 'images/Beretta.png', damage: 25, fire: 750, ammo: '9mm', magStd: 15, magExt: 30 },
        { name: 'G26', rarity: 'common', category: 'Pistols', img: 'images/G26.png', damage: 25, fire: 740, ammo: '9mm', magStd: 10, magExt: 20 },
        { name: 'G2C T1', rarity: 'common', category: 'Pistols', img: 'images/G2C_T1.png', damage: 25, fire: 750, ammo: '9mm', magStd: 12, magExt: 24 },
        { name: 'G41 Tier 1', rarity: 'common', category: 'Pistols', img: 'images/G41_Tier1.png', damage: 25, fire: 760, ammo: '.45 ACP', magStd: 13, magExt: 26 },
        { name: 'G43', rarity: 'common', category: 'Pistols', img: 'images/G43.png', damage: 25, fire: 710, ammo: '9mm', magStd: 10, magExt: 20 },
        { name: 'S XD9', rarity: 'common', category: 'Pistols', img: 'images/S_XD9.png', damage: 25, fire: 730, ammo: '9mm', magStd: 16, magExt: 32 },
        { name: 'TP9', rarity: 'common', category: 'Pistols', img: 'images/TP9.png', damage: 25, fire: 740, ammo: '9mm', magStd: 18, magExt: 36 },
        { name: 'Taurus Civilian', rarity: 'common', category: 'Pistols', img: 'images/Taurus_Civilian.png', damage: 25, fire: 720, ammo: '9mm', magStd: 15, magExt: 30 }
      ],
      tier1: [
        { name: '.38 Special', rarity: 'common', category: 'Pistols', img: 'images/38_special.png', damage: 25, fire: 750, ammo: '9mm', magStd: 15, magExt: 33 },
        { name: 'Ghost Glock 17', rarity: 'common', category: 'Pistols', img: 'images/ghost_glock17.png', damage: 25, fire: 750, ammo: '9mm', magStd: 15, magExt: 33 },
        { name: 'Beretta M9', rarity: 'common', category: 'Pistols', img: 'images/beretta_m9.png', damage: 25, fire: 750, ammo: '9mm', magStd: 15, magExt: 30 },
        { name: 'G23', rarity: 'uncommon', category: 'Pistols', img: 'images/g23.png', damage: 28, fire: 750, ammo: '9mm', magStd: 16, magExt: 32 },
        { name: 'Fn509', rarity: 'uncommon', category: 'Pistols', img: 'images/fn509.png', damage: 28, fire: 780, ammo: '9mm', magStd: 17, magExt: 34 },
        { name: 'G19x', rarity: 'uncommon', category: 'Pistols', img: 'images/g19x.png', damage: 28, fire: 790, ammo: '9mm', magStd: 19, magExt: 38 },
        { name: 'G19 MOS', rarity: 'rare', category: 'Pistols', img: 'images/g19_mos.png', damage: 30, fire: 900, ammo: '5.7x28', magStd: 50, magExt: 100 },
        { name: 'G17B', rarity: 'epic', category: 'Pistols', img: 'images/g17b.png', damage: 35, fire: 920, ammo: '9mm', magStd: 17, magExt: 34 },
        { name: 'G40', rarity: 'epic', category: 'Pistols', img: 'images/g40.png', damage: 35, fire: 880, ammo: '10mm', magStd: 15, magExt: 30 }
      ],
      tier2: [
        { name: 'AK-47', rarity: 'legendary', category: 'ARs', img: 'images/ak47.png', damage: 36, fire: 750, ammo: '5.56x45', magStd: 30, magExt: 60 },
        { name: 'HELLPUP DRACO', rarity: 'legendary', category: 'ARs', img: 'images/hellpup.png', damage: 36, fire: 750, ammo: '5.56x45', magStd: 30, magExt: 60 },
        { name: 'All Black Draco', rarity: 'legendary', category: 'ARs', img: 'images/all_black_draco.png', damage: 36, fire: 750, ammo: '5.56x45', magStd: 30, magExt: 60 },
        { name: 'ZPAP M92', rarity: 'legendary', category: 'ARs', img: 'images/ZPAP_M92.png', damage: 36, fire: 780, ammo: '7.62x39', magStd: 30, magExt: 60 },
        { name: 'Deagle', rarity: 'legendary', category: 'Pistols', img: 'images/deagle.png', damage: 36, fire: 600, ammo: '.50 AE', magStd: 7, magExt: 14 },
        { name: 'G18c', rarity: 'legendary', category: 'Pistols', img: 'images/g18c.png', damage: 36, fire: 1200, ammo: '9mm', magStd: 17, magExt: 34 },
        { name: 'P90', rarity: 'legendary', category: 'SMG', img: 'images/p90.png', damage: 36, fire: 1100, ammo: '5.7x28', magStd: 50, magExt: 100 },
        { name: 'MP5A3', rarity: 'legendary', category: 'SMG', img: 'images/mp5_a3.png', damage: 36, fire: 950, ammo: '9mm', magStd: 30, magExt: 60 },
        { name: 'M16A1', rarity: 'legendary', category: 'ARs', img: 'images/m16a1.png', damage: 36, fire: 800, ammo: '5.56x45', magStd: 30, magExt: 60 },
        { name: 'Red Draco', rarity: 'legendary', category: 'ARs', img: 'images/red_draco.png', damage: 35, fire: 830, ammo: '7.62x39', magStd: 30, magExt: 60 }
      ],
      drugs: [
        { name: 'Weed', rarity: 'common', category: 'Common', price: '$200â€“$750' },
        { name: 'Shrooms', rarity: 'common', category: 'Common', price: '$500â€“$750' },
        { name: 'Xanax', rarity: 'uncommon', category: 'Uncommon', price: '$700â€“$1,100' },
        { name: 'Perc 20s', rarity: 'uncommon', category: 'Uncommon', price: '$700â€“$1,000' },
        { name: 'Perc 30s', rarity: 'rare', category: 'Rare', price: '$1,200â€“$2,500' },
        { name: 'Green', rarity: 'rare', category: 'Rare', price: '$900â€“$1,800' },
        { name: 'Tris', rarity: 'epic', category: 'Epic', price: '$2,000â€“$3,500' },
        { name: 'Quagen', rarity: 'epic', category: 'Epic', price: '$3,500â€“$6,500' },
        { name: 'Wockhardt', rarity: 'legendary', category: 'Legendary', price: '$4,000â€“$7,000' },
        { name: 'PCP', rarity: 'legendary', category: 'Legendary', price: '$7,000â€“$10,000' }
      ]
    };

    // Weapon Stats Reference
    const WEAPON_STATS = {
      'Beretta': { damage: 25, fire: 750, ammo: '9mm', magStd: 15, magExt: 30 },
      'G26': { damage: 25, fire: 740, ammo: '9mm', magStd: 10, magExt: 20 },
      'G2C T1': { damage: 25, fire: 750, ammo: '9mm', magStd: 12, magExt: 24 },
      'G41 Tier 1': { damage: 25, fire: 760, ammo: '.45 ACP', magStd: 13, magExt: 26 },
      'G43': { damage: 25, fire: 710, ammo: '9mm', magStd: 10, magExt: 20 },
      'S XD9': { damage: 25, fire: 730, ammo: '9mm', magStd: 16, magExt: 32 },
      'TP9': { damage: 25, fire: 740, ammo: '9mm', magStd: 18, magExt: 36 },
      'Taurus Civilian': { damage: 25, fire: 720, ammo: '9mm', magStd: 15, magExt: 30 },
      '.38 Special': { damage: 25, fire: 750, ammo: '9mm', magStd: 15, magExt: 33 },
      'Ghost Glock 17': { damage: 25, fire: 750, ammo: '9mm', magStd: 15, magExt: 33 },
      'Beretta M9': { damage: 25, fire: 750, ammo: '9mm', magStd: 15, magExt: 30 },
      'G23': { damage: 28, fire: 750, ammo: '9mm', magStd: 16, magExt: 32 },
      'Fn509': { damage: 28, fire: 780, ammo: '9mm', magStd: 17, magExt: 34 },
      'G19x': { damage: 28, fire: 790, ammo: '9mm', magStd: 19, magExt: 38 },
      'G19 MOS': { damage: 30, fire: 900, ammo: '5.7x28', magStd: 50, magExt: 100 },
      'G17B': { damage: 35, fire: 920, ammo: '9mm', magStd: 17, magExt: 34 },
      'G40': { damage: 35, fire: 880, ammo: '10mm', magStd: 15, magExt: 30 },
      'AK-47': { damage: 36, fire: 750, ammo: '5.56x45', magStd: 30, magExt: 60 },
      'HELLPUP DRACO': { damage: 36, fire: 750, ammo: '5.56x45', magStd: 30, magExt: 60 },
      'All Black Draco': { damage: 36, fire: 750, ammo: '5.56x45', magStd: 30, magExt: 60 },
      'ZPAP M92': { damage: 36, fire: 780, ammo: '7.62x39', magStd: 30, magExt: 60 },
      'Deagle': { damage: 36, fire: 600, ammo: '.50 AE', magStd: 7, magExt: 14 },
      'G18c': { damage: 36, fire: 1200, ammo: '9mm', magStd: 17, magExt: 34 },
      'P90': { damage: 36, fire: 1100, ammo: '5.7x28', magStd: 50, magExt: 100 },
      'MP5A3': { damage: 36, fire: 950, ammo: '9mm', magStd: 30, magExt: 60 },
      'M16A1': { damage: 36, fire: 800, ammo: '5.56x45', magStd: 30, magExt: 60 },
      'Red Draco': { damage: 35, fire: 830, ammo: '7.62x39', magStd: 30, magExt: 60 }
    };

    const SUBTABS = {
      testDrops: ['All', 'Pistols', 'SMG'],
      tier1: ['All', 'Pistols', 'SMG'],
      tier2: ['All', 'ARs', 'Snipers', 'LMGs'],
      drugs: ['All', 'Common', 'Rare'],
      forums: ['All'],
      roe: ['All']
    };

    const TABS = [
      { id: 'testDrops', name: 'Test Drops', icon: 'fa-bullseye' },
      { id: 'tier1', name: 'Tier 1 Drops', icon: 'fa-gun' },
      { id: 'tier2', name: 'Tier 2 Drops', icon: 'fa-shield' },
      { id: 'drugs', name: 'Drugs', icon: 'fa-capsules' },
      { id: 'roe', name: 'ROE', icon: 'fa-book' },
      { id: 'forums', name: 'Forums', icon: 'fa-comments' }
    ];

    let currentTab = 'testDrops';
    let currentFilter = 'all';
    let currentSubtab = 'All';
    let isSpinning = false;
    let acquiredItems = [];

    // Initialize Navigation
    function initNav() {
      const mainNav = document.getElementById('mainNav');
      mainNav.innerHTML = TABS.map(tab => `
        <button class="main-tab ${tab.id === currentTab ? 'active' : ''}" data-tab="${tab.id}" onclick="switchTab('${tab.id}')">
          <i class="fas ${tab.icon}"></i> ${tab.name}
        </button>
      `).join('');
    }

    // Switch Tab
    function switchTab(tabId) {
      currentTab = tabId;
      currentFilter = 'all';
      currentSubtab = SUBTABS[tabId][0];
      document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
      renderSubtabs();
      renderContent();
    }

    // Render Subtabs
    function renderSubtabs() {
      const subtabs = document.getElementById('subtabs');
      const tabs = SUBTABS[currentTab] || [];
      subtabs.innerHTML = tabs.map(tab => `
        <button class="subtab ${tab === currentSubtab ? 'active' : ''}" onclick="setSubtab('${tab}')">
          ${tab}
        </button>
      `).join('');
    }

    function setSubtab(tab) {
      currentSubtab = tab;
      document.querySelectorAll('.subtab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      renderContent();
    }

    // Render Content
    function renderContent() {
      const content = document.getElementById('content');
      
      if (currentTab === 'testDrops') {
        renderWeapons('testDrops', 'Test Drops');
      } else if (currentTab === 'tier1') {
        renderWeapons('tier1', 'Tier 1 Drops');
      } else if (currentTab === 'tier2') {
        renderWeapons('tier2', 'Tier 2 Drops');
      } else if (currentTab === 'drugs') {
        renderDrugs();
      } else if (currentTab === 'roe') {
        renderROE();
      } else if (currentTab === 'forums') {
        renderForums();
      }
    }

    // Render Weapons
    function renderWeapons(category, title) {
      const content = document.getElementById('content');
      const weapons = WEAPONS[category] || [];
      
      let html = `<div class="section-title"><i class="fas fa-gun"></i> ${title}</div>`;
      html += `<div class="controls">
        <div class="filter-group">
          <label>Rarity:</label>
          <select onchange="currentFilter = this.value; renderContent()">
            <option value="all">All</option>
            <option value="common">Common</option>
            <option value="uncommon">Uncommon</option>
            <option value="rare">Rare</option>
            <option value="epic">Epic</option>
            <option value="legendary">Legendary</option>
          </select>
        </div>
        <button class="btn btn-drop" onclick="executeSpinWheel('${category}')">
          <i class="fas fa-dice"></i> DROP
        </button>
      </div>`;

      if (category === 'testDrops') {
        html += `
          <div class="spin-section">
            <div class="spin-title"><i class="fas fa-spinner"></i> Spin Wheel</div>
            <div class="spin-strip" id="spinStrip"></div>
            <div class="spin-indicator"></div>
            <div class="landed-display" id="landedDisplay">
              <img id="landedImage" class="landed-image" src="" alt="">
              <div class="landed-info">
                <div class="landed-label">YOU GOT:</div>
                <div class="landed-name" id="landedName"></div>
                <div class="landed-rarity" id="landedRarity"></div>
              </div>
            </div>
            <div class="spin-controls">
              <button class="btn-spin" id="spinBtn" onclick="executeSpinWheel('${category}')">
                <i class="fas fa-spinner"></i> SPIN
              </button>
            </div>
          </div>
        `;
      }

      html += `<div class="items-grid">`;
      
      const filtered = weapons.filter(w => currentFilter === 'all' || w.rarity === currentFilter);
      filtered.forEach(weapon => {
        html += `
          <div class="item-card" onclick="showItemDetails('${weapon.name}', '${weapon.rarity}')">
            <img src="${weapon.img}" alt="${weapon.name}" class="item-image" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22120%22%3E%3Crect fill=%23222%22 width=%22120%22 height=%22120%22/%3E%3C/svg%3E'">
            <div class="item-name">${weapon.name}</div>
            <div class="item-rarity rarity-${weapon.rarity}">${weapon.rarity}</div>
          </div>
        `;
      });
      
      html += `</div>`;
      content.innerHTML = html;

      if (category === 'testDrops') {
        renderSpinStrip('testDrops');
      }
    }

    // Render Drugs
    function renderDrugs() {
      const content = document.getElementById('content');
      const drugs = WEAPONS.drugs || [];
      
      let html = `<div class="section-title"><i class="fas fa-capsules"></i> Drugs</div>`;
      html += `<div class="content-text">Current market prices for all available substances in the network.</div>`;
      html += `<div class="controls">
        <div class="filter-group">
          <label>Rarity:</label>
          <select onchange="currentFilter = this.value; renderDrugs()">
            <option value="all">All</option>
            <option value="common">Common</option>
            <option value="uncommon">Uncommon</option>
            <option value="rare">Rare</option>
            <option value="epic">Epic</option>
            <option value="legendary">Legendary</option>
          </select>
        </div>
      </div>`;

      html += `<div class="items-grid">`;
      
      const filtered = drugs.filter(d => currentFilter === 'all' || d.rarity === currentFilter);
      filtered.forEach(drug => {
        html += `
          <div class="item-card" onclick="showDrugDetails('${drug.name}', '${drug.price}', '${drug.rarity}')">
            <i class="fas fa-droplet" style="font-size: 40px; color: #ff0000; margin-bottom: 10px;"></i>
            <div class="item-name">${drug.name}</div>
            <div class="item-rarity rarity-${drug.rarity}">${drug.rarity}</div>
            <div style="color: #999; font-size: 11px; margin-top: 8px;">${drug.price}</div>
          </div>
        `;
      });
      
      html += `</div>`;
      content.innerHTML = html;
    }

    // Render ROE
    function renderROE() {
      document.getElementById('content').innerHTML = `
        <div class="section-title"><i class="fas fa-book"></i> TFB 3.5 â€” Official Faction Roleplay Guidelines</div>
        <div class="content-text"><strong>Welcome to TFB 3.5</strong>, a serious roleplay server focused on high-quality faction roleplay.<br>By engaging in faction RP, you acknowledge and agree to all rules listed below.<br>Breaking any rule may result in punishment or faction strikes.</div>
        
        <div class="section-subtitle" style="color: #ff6b6b;">ðŸ”´ FACTION ATTACK RULES</div>
        
        <div style="color: var(--primary-red); font-weight: 700; margin-top: 15px; margin-bottom: 8px;">General Attack Limits</div>
        <ul>
          <li>Max 4 attackers per faction (unless defending on your own turf)</li>
          <li>No attacks or robberies in the first/last 15 minutes of a server restart</li>
          <li>Minimum 3 negative interactions (fights, robbery, stabbing) are required before initiating a shootout</li>
          <li>Entering the death script = active attack</li>
          <li>Attacks must escalate realistically and organically</li>
          <li>Shooting in the air for RP is allowed, but no one can be injured</li>
        </ul>

        <div style="color: var(--primary-red); font-weight: 700; margin-top: 15px; margin-bottom: 8px;">Kill Limits & Deathmatching</div>
        <ul>
          <li>If 4+ people are on a turf, you may perform a deathmatching attack (no pinpointing)</li>
          <li>Maximum intentional kills per attack: 3 (marked in red)</li>
          <li>Unintentional extra kills: last victim is revived, no refunds</li>
          <li>If you shoot back, you lose protection</li>
        </ul>

        <div style="color: var(--primary-red); font-weight: 700; margin-top: 15px; margin-bottom: 8px;">Identification</div>
        <ul>
          <li>Tog names count as pinpointing only if unmasked</li>
          <li>If a masked user is avoiding RP, they may be attacked</li>
        </ul>

        <div class="section-subtitle" style="color: #ffa94d;">ðŸŸ  MISCELLANEOUS FACTION RULES</div>
        <ul>
          <li>All attackers must be inside the gang menu</li>
          <li>Non-members cannot participate in faction attacks</li>
          <li>Reloading during an attack is prohibited</li>
          <li>Double attacking is only allowed if the enemy hasn't slid back within 72 hours</li>
          <li>You cannot attack during cooldowns</li>
          <li>Attacks from supercars are restricted to Tier 2+ factions</li>
          <li>Solo attacks are allowed only against solo targets with valid RP</li>
          <li>If shot but not placed in death script, you may RP injuries</li>
          <li>Entering death script from gunfire = mandatory character kill</li>
          <li>Tier 2+ factions may attack every 12 hours</li>
          <li>Robbery cooldown: 4 hours</li>
          <li>Robbery requires 2 interactions unless strong reason exists (flashing money/guns/drugs)</li>
          <li>Robbing on a turf = faction attack</li>
          <li>Probationary factions cannot backdoor</li>
          <li>At least 3 interactions are required before any backdoor action</li>
          <li>All conflict must be built through RP, not excuses</li>
          <li>If someone avoids RP on another faction's turf, you may kill them</li>
          <li>Failure to fear RP = punishments</li>
        </ul>

        <div class="section-subtitle" style="color: #ffd93d;">ðŸŸ¡ ILLEGAL CIVILIAN RULES</div>
        <ul>
          <li>Illegal civilians may roleplay from a hood but cannot participate in faction beef unless joining that faction</li>
          <li>Must have positive interactions to defend a faction</li>
          <li>Illegal civs should have their own storylines, not live on blocks all day</li>
        </ul>

        <div class="section-subtitle" style="color: #b19cd9;">ðŸŸ£ POOR ESCALATION / FORBIDDEN ACTIONS</div>
        <ul>
          <li>Attacks from EVs, motorcycles, dirt bikes are forbidden (mopeds allowed)</li>
          <li>Poor escalation leads to punishments</li>
        </ul>

        <div class="section-subtitle" style="color: #90ee90;">ðŸŸ© MUTUAL COMBAT RULES</div>
        <ul>
          <li>When 5+ members from two factions meet in a hostile situation, it can escalate into faction conflict even in greenzones</li>
          <li>Max 8 members per faction (including allies) in brawls</li>
          <li>Do not linger on a turf for more than 10 minutes</li>
          <li>Hiding weapons with emotes = playing to win</li>
          <li>Non-participating faction members may not scout or spin enemy turf</li>
          <li>No beefing or shooting at public, promoted events</li>
          <li>Crosshair usage = immediate termination if proven</li>
          <li>Metagaming (Discord, streams, clips) = punishments or faction strikes</li>
          <li>Must stay in server 30 minutes after initiating an attack</li>
        </ul>

        <div class="section-subtitle" style="color: #64b5f6;">ðŸ”µ ROLEPLAY DEVELOPMENT RULES</div>
        <ul>
          <li>No faction activity until your faction has a thread</li>
          <li>Poor portrayal can lead to punishment</li>
          <li>No unnecessary local OOC</li>
          <li>Characters must be 72 hours old before participating in attacks</li>
          <li>You may only take clothes/shoes, not inventory items, after knocking someone out</li>
          <li>Hackers/hitbox users in a faction will lead to consequences</li>
          <li>Public OOC toxicity = punishments</li>
          <li>Repeated turf provoking or greenzone provoking = strikes/closure</li>
        </ul>

        <div class="section-subtitle" style="color: #ff6b6b;">ðŸ”« ENGAGEMENT & SHOOTOUT GUIDELINES</div>
        <ul>
          <li>No speed boosting or "100k or die" shooting</li>
          <li>Shooter POV with sound and 3 minutes must be provided if asked</li>
          <li>Must be recorded with GeForce/AMD, or Twitch/Kick VOD showing desktop/taskbar</li>
        </ul>

        <div class="section-subtitle">ðŸŒŠ WATER EVADING</div>
        <ul>
          <li>No using water to escape police, factions, or to remove GSR</li>
        </ul>

        <div class="section-subtitle">ðŸ“„ FACTION REPORTS</div>
        <ul>
          <li>Reports must be made within 48 hours</li>
          <li>No revenge-motivated reports</li>
          <li>If you have an active report, do not interact negatively with that faction</li>
          <li>Factions under report review may be banned from selling guns/drugs</li>
        </ul>

        <div class="section-subtitle">ðŸ—ƒ WEAPON LOGGING & REFILL POLICY</div>
        <ul>
          <li>Logged faction guns can be respawned after 3 days (not for test factions)</li>
          <li>All guns must be logged. Unlogged firearms = bans/strikes</li>
        </ul>
      `;
    }

    // Render Forums
    function renderForums() {
      document.getElementById('content').innerHTML = `
        <div class="section-title"><i class="fas fa-comments"></i> Forums</div>
        <div class="content-text">Community discussion board for all faction members. Share strategies and coordinate operations.</div>
        
        <div class="items-grid" style="grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));">
          <div class="item-card">
            <i class="fas fa-comments" style="font-size: 40px; color: #ff0000; margin-bottom: 10px;"></i>
            <div class="item-name">General Discussion</div>
            <div style="color: #999; font-size: 12px; margin-top: 8px;">Share ideas and discuss operations</div>
          </div>
          <div class="item-card">
            <i class="fas fa-users" style="font-size: 40px; color: #ff0000; margin-bottom: 10px;"></i>
            <div class="item-name">Member Introductions</div>
            <div style="color: #999; font-size: 12px; margin-top: 8px;">New members introduce themselves</div>
          </div>
          <div class="item-card">
            <i class="fas fa-map-marker-alt" style="font-size: 40px; color: #ff0000; margin-bottom: 10px;"></i>
            <div class="item-name">Territory Updates</div>
            <div style="color: #999; font-size: 12px; margin-top: 8px;">Faction territory information</div>
          </div>
          <div class="item-card">
            <i class="fas fa-bell" style="font-size: 40px; color: #ff0000; margin-bottom: 10px;"></i>
            <div class="item-name">Announcements</div>
            <div style="color: #999; font-size: 12px; margin-top: 8px;">Important faction updates</div>
          </div>
        </div>

        <div class="section-subtitle">Forum Rules</div>
        <ul>
          <li>Respect all members - No disrespect or harassment</li>
          <li>No snitching - Do not share sensitive information</li>
          <li>Keep it relevant - Stay on topic</li>
          <li>No spam - Quality over quantity</li>
          <li>Follow hierarchy - Respect leadership</li>
        </ul>
      `;
    }

    // Show Item Details
    function showItemDetails(name, rarity) {
      const modal = document.getElementById('itemModal');
      const stats = WEAPON_STATS[name] || {};
      document.getElementById('modalTitle').textContent = name;
      
      let statsHtml = '';
      if(stats.damage) {
        statsHtml += `
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 15px 0;">
            <div style="background: rgba(0,0,0,0.5); padding: 12px; border-radius: 8px; border: 1px solid var(--border-red);">
              <div style="color: var(--text-light-gray); font-size: 11px; font-weight: 700; text-transform: uppercase; margin-bottom: 8px;">Damage</div>
              <div style="color: var(--primary-red); font-size: 24px; font-weight: 900;">${stats.damage}</div>
            </div>
            <div style="background: rgba(0,0,0,0.5); padding: 12px; border-radius: 8px; border: 1px solid var(--border-red);">
              <div style="color: var(--text-light-gray); font-size: 11px; font-weight: 700; text-transform: uppercase; margin-bottom: 8px;">Fire Rate</div>
              <div style="color: var(--primary-red); font-size: 24px; font-weight: 900;">${stats.fire} RPM</div>
            </div>
            <div style="background: rgba(0,0,0,0.5); padding: 12px; border-radius: 8px; border: 1px solid var(--border-red);">
              <div style="color: var(--text-light-gray); font-size: 11px; font-weight: 700; text-transform: uppercase; margin-bottom: 8px;">Ammo</div>
              <div style="color: var(--primary-red); font-size: 18px; font-weight: 900;">${stats.ammo || '-'}</div>
            </div>
            <div style="background: rgba(0,0,0,0.5); padding: 12px; border-radius: 8px; border: 1px solid var(--border-red);">
              <div style="color: var(--text-light-gray); font-size: 11px; font-weight: 700; text-transform: uppercase; margin-bottom: 8px;">Magazine</div>
              <div style="color: var(--primary-red); font-size: 16px; font-weight: 900;">Reg: ${stats.magStd || '-'} | Ext: ${stats.magExt || '-'}</div>
            </div>
          </div>
        `;
      }
      
      document.getElementById('modalBody').innerHTML = `
        <div class="content-text">
          <strong>Rarity:</strong> <span class="item-rarity rarity-${rarity}">${rarity}</span>
        </div>
        ${statsHtml}
        <div class="content-text" style="margin-top: 15px;">
          <strong>Status:</strong> Available in inventory
        </div>
        <button class="btn btn-drop" onclick="closeModal()" style="margin-top: 20px; width: 100%;">
          CLOSE
        </button>
      `;
      modal.classList.add('active');
    }

    function showDrugDetails(name, price, rarity) {
      const modal = document.getElementById('itemModal');
      document.getElementById('modalTitle').textContent = name;
      document.getElementById('modalBody').innerHTML = `
        <div class="content-text">
          <strong>Market Price:</strong> ${price}
        </div>
        <div class="content-text">
          <strong>Rarity:</strong> <span class="item-rarity rarity-${rarity}">${rarity}</span>
        </div>
        <div class="content-text">
          <strong>Availability:</strong> In stock
        </div>
        <button class="btn btn-drop" onclick="closeModal()" style="margin-top: 20px; width: 100%;">
          CLOSE
        </button>
      `;
      modal.classList.add('active');
    }

    function closeModal() {
      document.getElementById('itemModal').classList.remove('active');
    }

    // Spin Wheel Functions
    function renderSpinStrip(category) {
      const spinStrip = document.getElementById('spinStrip');
      if (!spinStrip) return;
      
      const weapons = WEAPONS[category] || [];
      spinStrip.innerHTML = '';
      
      for (let i = 0; i < 15; i++) {
        const weapon = weapons[Math.floor(Math.random() * weapons.length)];
        const tile = document.createElement('div');
        tile.className = 'spin-item';
        tile.innerHTML = `
          <img src="${weapon.img}" alt="${weapon.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22%3E%3Crect fill=%23222%22 width=%2240%22 height=%2240%22/%3E%3C/svg%3E'">
          <div class="spin-item-name">${weapon.name}</div>
        `;
        spinStrip.appendChild(tile);
      }
    }

    function executeSpinWheel(category) {
      if (isSpinning) return;
      
      isSpinning = true;
      const spinBtn = document.getElementById('spinBtn');
      const spinStrip = document.getElementById('spinStrip');
      const landedDisplay = document.getElementById('landedDisplay');
      
      if (!spinStrip) return;
      
      const weapons = WEAPONS[category] || [];
      if (spinBtn) spinBtn.disabled = true;
      if (landedDisplay) landedDisplay.classList.remove('active');
      
      const spinDuration = 2000;
      const startTime = Date.now();
      const weaponCount = spinStrip.children.length;
      
      const spinAnimation = setInterval(() => {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / spinDuration, 1);
        const easeProgress = 1 - Math.pow(1 - progress, 3);
        const positions = Math.floor(easeProgress * weaponCount * 3);
        
        let first = spinStrip.firstElementChild;
        for (let i = 0; i < (positions % weaponCount); i++) {
          if (first) spinStrip.appendChild(spinStrip.removeChild(first));
          first = spinStrip.firstElementChild;
        }
        
        if (progress === 1) {
          clearInterval(spinAnimation);
          const selectedWeapon = weapons[Math.floor(Math.random() * weapons.length)];
          acquiredItems.push(selectedWeapon);
          
          if (landedDisplay) {
            document.getElementById('landedImage').src = selectedWeapon.img;
            document.getElementById('landedName').textContent = selectedWeapon.name;
            document.getElementById('landedRarity').textContent = selectedWeapon.rarity.toUpperCase();
            document.getElementById('landedRarity').className = `landed-rarity rarity-${selectedWeapon.rarity}`;
            landedDisplay.classList.add('active');
          }
          
          setTimeout(() => showVictoryModal([selectedWeapon]), 1000);
          isSpinning = false;
          if (spinBtn) spinBtn.disabled = false;
        }
      }, 30);
    }

    function showVictoryModal(items) {
      const victoryModal = document.getElementById('victoryModal');
      const victoryItems = document.getElementById('victoryItems');
      const victoryCount = document.getElementById('victoryCount');
      
      victoryCount.textContent = `${items.length} ITEM${items.length > 1 ? 'S' : ''}`;
      victoryItems.innerHTML = items.map((item, idx) => `
        <div class="victory-item" style="animation-delay: ${idx * 0.1}s;">
          <img src="${item.img}" alt="${item.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2270%22 height=%2270%22%3E%3Crect fill=%23222%22 width=%2270%22 height=%2270%22/%3E%3C/svg%3E'">
          <div class="victory-item-name">${item.name}</div>
          <div class="victory-item-rarity rarity-${item.rarity}">${item.rarity}</div>
        </div>
      `).join('');
      
      victoryModal.classList.add('active');
    }

    function closeVictory() {
      document.getElementById('victoryModal').classList.remove('active');
    }

    function toggleMusic() {
      const label = document.getElementById('musicLabel');
      if (label.textContent === 'MUSIC: OFF') {
        label.textContent = 'MUSIC: ON';
      } else {
        label.textContent = 'MUSIC: OFF';
      }
    }

    // Modal click outside
    document.getElementById('itemModal').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });

    document.getElementById('victoryModal').addEventListener('click', function(e) {
      if (e.target === this) closeVictory();
    });

    // Initialize
    initNav();
    renderSubtabs();
    renderContent();
  </script>
</body>
</html>
